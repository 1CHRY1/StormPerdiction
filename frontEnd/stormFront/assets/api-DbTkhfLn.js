import{s as p,i as u}from"./stationInfo-BWRfB6xq.js";const b=async t=>{const e=await fetch(`/geojson/${t}-stormData.geojson`).then(n=>n.json()).then(n=>n),o={name:e.name,dataList:[]};for(const n of e.features){const a=n.geometry.coordinates,s=n.properties,r={id:s.id,time:s.time,strong:s.strong,power:Number(s.power),speed:Number(s.speed),lng:a[0],lat:a[1]};o.dataList.push(r)}return o},x=t=>{const e=new Date(t),o=("0"+(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2),a=("0"+e.getHours()).slice(-2);return o+"月"+n+"日 "+a+"时"},M=t=>t.dataList.map(o=>({id:o.id,time:x(o.time),powerAndStrong:`${o.power} (${o.strong})`,speed:o.speed})),j=t=>{const e=Math.floor(t),o=Math.floor((t-e)*60);return e+"° "+o+"'"},y=t=>({type:"Feature",name:"",properties:{},geometry:{type:"Point",coordinates:t}}),I=async(t,e)=>{t.addSource("storm-point",{type:"geojson",data:`/geojson/${e}-point.geojson`,attribution:"name"}),t.addSource("storm-line",{type:"geojson",data:`/geojson/${e}-line.geojson`,attribution:"name"}),t.addLayer({id:"storm-line",source:"storm-line",type:"line",paint:{"line-color":"#60a5fa","line-width":1.5}}),t.addLayer({id:"storm-point",source:"storm-point",type:"circle",paint:{"circle-stroke-color":"#71717a","circle-stroke-width":1,"circle-radius":["case",["<=",["to-number",["get","power"]],8],4,["+",["*",["to-number",["get","power"]],.2],2.5]],"circle-color":["case",["<=",["to-number",["get","power"]],8],"#4ef04e",["<=",["to-number",["get","power"]],9],"#5281e6",["<=",["to-number",["get","power"]],11],"#e7e827",["<=",["to-number",["get","power"]],13],"#e49c26",["<=",["to-number",["get","power"]],15],"#e276de","#cd0000"]}})},L=async(t,e)=>{t.getSource("storm-point").setData(`/geojson/${e}-point.geojson`),t.getSource("storm-line").setData(`/geojson/${e}-line.geojson`)},A=async(t,e)=>{t.addSource("typhoon",{type:"geojson",data:y(e)});const o=await new Promise(n=>{t.loadImage("/png/typhoon.png",(a,s)=>{n(s)})});t.addImage("typhoon-icon",o),t.addLayer({id:"typhoon",source:"typhoon",type:"symbol",layout:{"icon-image":"typhoon-icon"}})},$=(t,e)=>{t.getSource("typhoon").setData(y(e))},F=async t=>{t.addSource("stations",{type:"geojson",data:"/geojson/199711-station.geojson",attribution:"name"});const e=await new Promise(o=>{t.loadImage("/png/custom_marker.png",(n,a)=>{o(a)})});t.addImage("station-marker",e),t.addLayer({id:"stations",source:"stations",type:"symbol",layout:{"icon-image":"station-marker","icon-size":.6,"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,1.25],"text-anchor":"top","text-size":18},paint:{"text-color":"#e2e8f0"}})},T=()=>["1","6","7","8","10","14"].map(o=>({id:o,label:p[o].name})),k=t=>u(t.value),S=async(t,e,o,n)=>{const a=Math.min(...e.hpre,...e.hyubao),s=Math.max(...e.hpre,...e.hyubao),r=s-a,c=Math.min(...e.hadd),l=Math.max(...e.hadd),m=l-c,d={title:{text:`${o.name}站点 ${o.time} 历史潮位图`,textStyle:{color:"hsl(220, 50%, 50%)",fontSize:20}},tooltip:{trigger:"axis"},legend:{data:["天文潮位","总潮位","台风增水"],right:"15%",top:"1%"},grid:[{left:60,right:50,height:"35%"},{left:60,right:50,top:"55%",height:"35%"}],toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[15,0,0,50]}},{gridIndex:1,data:e.time,axisLabel:{show:!1},position:"top"}],yAxis:[{type:"value",min:a-r*.05,max:s+r*.05,axisLabel:{formatter:function(i){return i.toFixed(2)}}},{type:"value",gridIndex:1,min:c-m*.05,max:l+m*.05,axisLabel:{formatter:function(i){return i.toFixed(2)}}}],series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre},{name:"总潮位",type:"line",smooth:!0,data:e.hyubao},{name:"台风增水",type:"line",smooth:!0,data:e.hadd,yAxisIndex:1,xAxisIndex:1}]};n||(d.graphic={type:"text",left:"center",top:"middle",silent:!0,invisible:e.hpre.length>0,style:{fill:"#9d9d9d",fontWeight:"bold",text:"该时间段暂无数据",fontFamily:"Microsoft YaHei",fontSize:"25px"}}),d&&t.setOption(d)},v=async(t,e,o,n,a)=>{const s=Math.min(...e.hpre,...e.hyubao),r=Math.max(...e.hpre,...e.hyubao),c=r-s,l=Math.min(...e.hadd),m=Math.max(...e.hadd),d=m-l,i={title:{text:`${o.name}站点${o.time}历史潮位`,top:"1%",textStyle:{color:"hsl(220, 50%, 50%)",fontSize:15}},tooltip:a?void 0:{trigger:"axis"},legend:{data:["天文潮位","总潮位","台风增水"],right:"15%",top:"8%"},grid:[{left:60,right:50,top:"20%",height:"30%"},{left:60,right:50,top:"65%",height:"30%"}],toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[15,0,0,50]}},{gridIndex:1,data:e.time,axisLabel:{show:!1},position:"top"}],yAxis:[{type:"value",min:s-c*.05,max:r+c*.05,axisLabel:{formatter:function(h){return h.toFixed(2)}}},{type:"value",gridIndex:1,min:l-d*.05,max:m+d*.05,axisLabel:{formatter:function(h){return h.toFixed(2)}}}],series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre},{name:"总潮位",type:"line",smooth:!0,data:e.hyubao},{name:"台风增水",type:"line",smooth:!0,data:e.hadd,yAxisIndex:1,xAxisIndex:1}]};n||(i.graphic={type:"text",left:"center",top:"middle",silent:!0,invisible:e.hpre.length>0,style:{fill:"#9d9d9d",fontWeight:"bold",text:"该时间段暂无数据",fontFamily:"Microsoft YaHei",fontSize:"25px"}}),i&&t.setOption(i)},g=t=>{const e=Math.floor(t),o=Math.floor((t-e)*60);return e+"° "+o+"'"},z=t=>{const e=p[t];return{name:e.name,pinyin:e.pinyin,time:"1997/8/13",lon:g(e.coord[0]),lat:g(e.coord[1]),type:e.type}},O=async t=>{const e=`/geojson/199711-station/${p[t].pinyin}.json`,o=await fetch(e).then(n=>n.status===200?n.json():{time:[],hpre:[null],hyubao:[null],hadd:[null]}).then(n=>n);return o.hadd.includes(null)||o.hyubao.includes(null)||o.hpre.includes(null)?{isTyphoon:!1,time:[],hpre:[],hyubao:[],hadd:[]}:{isTyphoon:!0,time:o.time,hpre:o.hpre,hyubao:o.hyubao,hadd:o.hadd}};export{O as a,b,M as c,v as d,F as e,I as f,z as g,A as h,k as i,$ as j,x as k,j as l,T as m,S as n,L as u};
