import{u as P,a as F}from"./initMap-D0w7y-qV.js";import{b as z}from"./api-DD1IRPxf.js";import{g as N,r as m,c as O,h as A,o as B,b as y,d as g,e,t as u,u as x,f as d,i as k,l as D,q as H,s as R,_ as q}from"./index-DQkqiHjE.js";const $=t=>{const o=new Date(t),a=("0"+(o.getMonth()+1)).slice(-2),n=("0"+o.getDate()).slice(-2),r=("0"+o.getHours()).slice(-2);return a+"月"+n+"日 "+r+"时"},C=t=>t.map(a=>({id:a.id,name:a.name,time:$(a.time),powerAndStrong:`${a.power} (${a.strong})`,speed:a.speed})),T=t=>{const o=Math.floor(t),a=Math.floor((t-o)*60);return o+"° "+a+"'"},L=t=>({type:"Feature",name:"",properties:{},geometry:{type:"Point",coordinates:t}}),E=t=>({type:"FeatureCollection",features:t.map((n,r)=>({type:"Feature",name:"",properties:{power:n.power,id:r},geometry:{type:"Point",coordinates:[n.lng,n.lat]}}))}),V=t=>({type:"Feature",name:"",properties:{},geometry:{type:"LineString",coordinates:t.map(a=>[a.lng,a.lat])}}),G=async(t,o)=>{const a=E(o),n=V(o);t.addSource(`storm-${o[0].name}-point`,{type:"geojson",data:a}),t.addSource(`storm-${o[0].name}-line`,{type:"geojson",data:n}),t.addLayer({id:`storm-${o[0].name}-line`,source:`storm-${o[0].name}-line`,type:"line",paint:{"line-color":"#60a5fa","line-width":1.5}}),t.addLayer({id:`storm-${o[0].name}-point`,source:`storm-${o[0].name}-point`,type:"circle",paint:{"circle-stroke-color":"#71717a","circle-stroke-width":1,"circle-radius":["case",["<=",["to-number",["get","power"]],8],4,["+",["*",["to-number",["get","power"]],.2],2.5]],"circle-color":["case",["<=",["to-number",["get","power"]],8],"#4ef04e",["<=",["to-number",["get","power"]],9],"#5281e6",["<=",["to-number",["get","power"]],11],"#e7e827",["<=",["to-number",["get","power"]],13],"#e49c26",["<=",["to-number",["get","power"]],15],"#e276de","#cd0000"]}})},J=async t=>{const o=await new Promise(a=>{t.loadImage("/png/typhoon.png",(n,r)=>{a(r)})});t.addImage("typhoon-icon",o),t.addSource("typhoon",{type:"geojson",data:L([0,0])})},K=(t,o)=>{t.getSource("typhoon").setData(L(o)),t.getLayer("typhoon")||t.addLayer({id:"typhoon",source:"typhoon",type:"symbol",layout:{"icon-image":"typhoon-icon"}})},i=t=>(H("data-v-f722ffaf"),t=t(),R(),t),Q={class:"relative flex h-full"},U={class:"flex h-full flex-auto relative justify-center"},W=i(()=>e("div",{class:"absolute z-10 top-3 py-1 px-16 text-yellow-400 font-bold text-2xl flex justify-center bg-slate-700/50 rounded"},u("实时台风路径"),-1)),X={class:"bg-white w-[21rem] flex flex-col"},Y={class:"h-48 m-2 border border-zinc-300 bg-white flex flex-col"},Z=i(()=>e("div",{class:"h-10 leading-10 px-3 bg-[#1b6ec8] text-white"},"实时信息",-1)),ee={key:0},te={class:"mx-2 my-1 flex flex-col"},oe=i(()=>e("span",{class:"inline-block pr-2"},"台风名称:",-1)),ae={class:"inline-block pr-3"},se={class:"mx-2 my-1 flex flex-col"},ne=i(()=>e("span",{class:"inline-block pr-2"},"当前时间:",-1)),le={class:"inline-block pr-3"},ce={class:"mx-2 my-1 flex flex-col"},re=i(()=>e("span",{class:"inline-block pr-2"},"中心位置:",-1)),ie={class:"inline-block pr-3"},de={class:"inline-block pr-3"},pe={class:"mx-2 my-1 flex flex-col"},ue=i(()=>e("span",{class:"inline-block pr-2"},"当前强度:",-1)),me={class:"inline-block pr-3"},_e={class:"mx-2 my-1 flex flex-col"},he=i(()=>e("span",{class:"inline-block pr-2"},"当前风速:",-1)),fe={class:"inline-block pr-3"},ve={key:1,class:"flex justify-center items-center flex-1 text-lg"},be={class:"m-2 mt-3 w-80 bg-white"},ye=i(()=>e("div",{class:"h-10 leading-10 px-3 bg-[#1b6ec8] text-white"},"实时台风",-1)),ge={class:"border border-zinc-300"},xe={class:"m-2 mt-3 w-80 bg-white flex flex-col flex-auto"},we=i(()=>e("div",{class:"h-10 leading-10 px-3 bg-[#1b6ec8] text-white"},"历史路径",-1)),Se={class:"border border-zinc-300 flex-auto"},ke=N({__name:"Typhoon",setup(t){const o=m(null),a=m(null),n=m(null),r=m("0"),s=m(null),f=P(),v=m(null),j=O(()=>a.value&&n.value?C(n.value[a.value].slice().reverse()):[]),M=c=>{c&&(a.value=c.name,r.value=(n.value[c.name].length-1).toString())},I=c=>{c&&(r.value=c.id)};return A(r,()=>{s.value=n.value[a.value][Number(r.value)],f.map&&(f.map.flyTo({center:[s.value.lng,s.value.lat]}),K(f.map,[s.value.lng,s.value.lat]))}),B(async()=>{n.value=await z(),a.value=Object.keys(n.value)[0],v.value=C(Object.values(n.value).map(l=>l[0]));const c=await F(o.value,{center:[133.4,30.2],zoom:4}),b=[];Object.values(n.value).forEach(l=>{b.push(`storm-${l[0].name}-point`),G(c,l)}),J(c),c.on("click",l=>{const _=[[l.point.x-3,l.point.y-3],[l.point.x+3,l.point.y+3]],p=c.queryRenderedFeatures(_,{layers:b});if(p&&p[0]){const h=p[0].properties.id;r.value=h,a.value=p[0].source.split("-")[1]}})}),(c,b)=>{var p,h,w,S;const l=D("el-table-column"),_=D("el-table");return y(),g("div",Q,[e("div",U,[W,e("div",{ref_key:"mapContainerRef",ref:o,class:"map-container h-full w-full"},null,512)]),e("div",X,[e("div",Y,[Z,((p=v.value)==null?void 0:p.length)!==0?(y(),g("div",ee,[e("div",te,[e("div",null,[oe,e("span",ae,u(s.value&&s.value.name),1)])]),e("div",se,[e("div",null,[ne,e("span",le,u(s.value&&x($)(s.value.time)),1)])]),e("div",ce,[e("div",null,[re,e("span",ie,u(s.value&&x(T)(s.value.lng)),1),e("span",de,u(s.value&&x(T)(s.value.lat)),1)])]),e("div",pe,[e("div",null,[ue,e("span",me,u(s.value&&`${(h=s.value)==null?void 0:h.power}级 (${(w=s.value)==null?void 0:w.strong})`),1)])]),e("div",_e,[e("div",null,[he,e("span",fe,u(s.value&&((S=s.value)==null?void 0:S.speed)+"m/s"),1)])])])):(y(),g("div",ve," 当前无台风 "))]),e("div",be,[ye,e("div",ge,[d(_,{stripe:"",border:"","table-layout":"auto",data:v.value,class:"h-[12rem]",onCurrentChange:M},{default:k(()=>[d(l,{prop:"name",label:"名称"}),d(l,{prop:"powerAndStrong",label:"强度"}),d(l,{prop:"speed",label:"风速"})]),_:1},8,["data"])])]),e("div",xe,[we,e("div",Se,[d(_,{stripe:"",border:"","table-layout":"auto",data:j.value,class:"h-[37vh]",onCurrentChange:I},{default:k(()=>[d(l,{prop:"time",label:"时间"}),d(l,{prop:"powerAndStrong",label:"强度"}),d(l,{prop:"speed",label:"风速"})]),_:1},8,["data"])])])])])}}}),$e=q(ke,[["__scopeId","data-v-f722ffaf"]]);export{$e as default};
