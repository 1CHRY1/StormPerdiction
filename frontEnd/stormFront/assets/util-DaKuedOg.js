import{s as x,i as p}from"./stationInfo-BWRfB6xq.js";import{g,a as y}from"./getStation-BFvQ2HL2.js";const m=n=>{const e=Math.floor(n),t=Math.floor((n-e)*60);return e+"° "+t+"'"},b=async()=>{const e=await fetch("/api/v1/process/model/run").then(t=>t.json()).then(t=>t.data);return console.log(e),!0},M=n=>{const e=x[n];return{name:e.name,pinyin:e.pinyin,time:new Date(Date.now()).toLocaleString().replace(/:\d\d$/,""),lon:m(e.coord[0]),lat:m(e.coord[1]),type:e.type}},A=async n=>{const e=`/api/v1/data/level/station/72?station=${x[n].pinyin}`,t=await fetch(e).then(o=>o.json()).then(o=>o.data);if(!t.hpre)return{time:[],hpre:[],isTyphoon:!1,hadd:[],hyubao:[]};const d=[],s=!!t.hadd,a=t.hpre,i=t.hyubao||[],r=t.hadd||[],l=t.hpre.length,h=new Date(t.time);for(let o=0;o<l;o++){const c=new Date(h.getTime()+o*60*60*1e3);d.push(c.toLocaleString().replace(/:\d\d$/,""))}return{time:d,isTyphoon:s,hyubao:i,hpre:a,hadd:r}},I=async()=>{const n=await g("forecast");return Object.entries(n).map(t=>({id:t[1].id,label:t[1].name}))},L=n=>p(n.value),v=async(n,e,t,d)=>{let s;if(e.isTyphoon){const a=Math.min(...e.hpre,...e.hyubao),i=Math.max(...e.hpre,...e.hyubao),r=i-a,l=Math.min(...e.hadd),h=Math.max(...e.hadd),o=h-l;s={title:{text:`${t.name}站点 ${t.time} 72 小时逐时潮位预报图`,textStyle:{color:"hsl(220, 50%, 50%)",fontSize:20}},tooltip:{trigger:"axis"},legend:{data:["天文潮位","总潮位","台风增水"],right:"15%",top:"1%"},grid:[{left:60,right:50,height:"35%"},{left:60,right:50,top:"55%",height:"35%"}],toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[15,0,0,50]}},{gridIndex:1,data:e.time,axisLabel:{show:!1},position:"top"}],yAxis:[{type:"value",min:a-r*.05,max:i+r*.05,axisLabel:{formatter:function(c){return c.toFixed(2)}}},{type:"value",gridIndex:1,min:l-o*.05,max:h+o*.05,axisLabel:{formatter:function(c){return c.toFixed(2)}}}],dataZoom:[{type:"inside",start:0,end:100,xAxisIndex:[0,1]},{start:0,end:100,xAxisIndex:[0,1]}],series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre},{name:"总潮位",type:"line",smooth:!0,data:e.hyubao},{name:"台风增水",type:"line",smooth:!0,data:e.hadd,yAxisIndex:1,xAxisIndex:1}]}}else{const a=Math.min(...e.hpre),i=Math.max(...e.hpre),r=i-a;s={title:{text:`${t.name}站点 ${t.time} 72 小时逐时潮位预报图`,textStyle:{color:"hsl(220, 50%, 50%)",fontSize:20}},tooltip:{trigger:"axis"},legend:{data:["天文潮位"],right:"15%",top:"1%"},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[0,0,0,50]}},yAxis:{type:"value",min:a-r*.05,max:i+r*.05,axisLabel:{formatter:function(l){return l.toFixed(2)}}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:20}],series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre}]}}d||(s.graphic={type:"text",left:"center",top:"middle",silent:!0,invisible:e.hpre.length>0,style:{fill:"#9d9d9d",fontWeight:"bold",text:"该时间段暂无数据",fontFamily:"Microsoft YaHei",fontSize:"25px"}}),s&&n.setOption(s)},T=async n=>{const e=await y("forecast");n.addSource("stations",{type:"geojson",data:e,attribution:"name"});const t=await new Promise(d=>{n.loadImage("/png/custom_marker.png",(s,a)=>{d(a)})});n.addImage("station-marker",t),n.addLayer({id:"stations",source:"stations",type:"symbol",layout:{"icon-image":"station-marker","icon-size":.6,"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,1.25],"text-anchor":"top","text-size":18},paint:{"text-color":"#e2e8f0"}})};export{T as a,I as b,A as c,v as d,M as g,L as i,b as r};
