import{i as p,s as c}from"./stationInfo-DixEZJLI.js";import{g,a as y}from"./getStation-DC6WyyE7.js";const u=async()=>{const o=await g("forecast"),e={datong:0,fenghuangjingzhanxia:1,yuxizhaxia:2,xinqiaozhaxia:3,wuhu:4,maanshan:5,nanjing:6,zhenjiang:7,jiangyin:8,xuliujing:9,yanglin:10,wusong:11,liuxiao:12,lianxinggang:13,jinqiao:14,zhapu:15,ganpu:16},t=new Array(26).fill(null);let d=17;return Object.entries(o).forEach(n=>{const i=e[n[1].pinyin];typeof i=="number"?t[i]={id:n[1].id,label:n[1].name}:(t[d]={id:n[1].id,label:n[1].name},d++)}),t.filter(n=>n)},M=o=>p(o.value),A=async(o,e,t,d)=>{let a;if(e.isTyphoon){const n=Math.min(...e.hpre,...e.hyubao),i=Math.max(...e.hpre,...e.hyubao),r=i-n,l=Math.min(...e.hadd),h=Math.max(...e.hadd),s=h-l;a={title:{text:`${t.name}站点 ${t.time} 72 小时逐时潮位预报图`,textStyle:{color:"hsl(220, 50%, 50%)",fontSize:20}},tooltip:{trigger:"axis"},legend:{data:["天文潮位","总潮位","台风增水"],right:"15%",top:"1%"},grid:[{left:60,right:50,height:"35%"},{left:60,right:50,top:"55%",height:"35%"}],toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[15,0,0,50]}},{gridIndex:1,data:e.time,axisLabel:{show:!1},position:"top"}],yAxis:[{type:"value",min:n-r*5,max:i+r*5,axisLabel:{formatter:function(x){return x.toFixed(2)}}},{type:"value",gridIndex:1,min:l-s*.05,max:h+s*.05,axisLabel:{formatter:function(x){return x.toFixed(2)}}}],dataZoom:[{type:"inside",start:0,end:100,xAxisIndex:[0,1]},{start:0,end:100,xAxisIndex:[0,1]}],series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre},{name:"总潮位",type:"line",smooth:!0,data:e.hyubao},{name:"台风增水",type:"line",smooth:!0,data:e.hadd,yAxisIndex:1,xAxisIndex:1}]}}else{const n=Math.min(...e.hpre),i=Math.max(...e.hpre),r=i-n;a={title:{text:`${t.name}站点 ${t.time} 72 小时逐时潮位预报图`,textStyle:{color:"hsl(220, 50%, 50%)",fontSize:20}},tooltip:{trigger:"axis"},legend:{data:["天文潮位"],right:"15%",top:"1%"},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[0,0,0,50]}},yAxis:{type:"value",min:n-r*5,max:i+r*5,axisLabel:{formatter:function(l){return l.toFixed(2)}}},series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre}],graphic:{elements:[{type:"text",style:{text:"单位:(m)",x:3,y:730,fontSize:13}}]}}}d||(a.graphic={type:"text",left:"center",top:"middle",silent:!0,invisible:e.hpre.length>0,style:{fill:"#9d9d9d",fontWeight:"bold",text:"该时间段暂无数据",fontFamily:"Microsoft YaHei",fontSize:"25px"}}),a&&o.setOption(a)},I=async(o,e,t,d,a)=>{console.log(a);let n;if(e.isTyphoon){const i=Math.min(...e.hpre,...e.hyubao),r=Math.max(...e.hpre,...e.hyubao),l=Math.min(...e.hadd),h=Math.max(...e.hadd),s=h-l;n={title:{text:`${t.name}站点 ${t.time} 72 小时逐时潮位预报`,top:"1%",textStyle:{color:"hsl(220, 50%, 50%)",fontSize:15}},tooltip:{trigger:"axis"},legend:{data:["天文潮位","总潮位","台风增水"],right:"15%",top:"8%"},grid:[{left:60,right:50,height:"35%"},{left:60,right:50,top:"55%",height:"35%"}],toolbox:a?void 0:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},axisPointer:{link:[{xAxisIndex:"all"}]},xAxis:[{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[15,0,0,50]}},{gridIndex:1,data:e.time,axisLabel:{show:!1},position:"top"}],yAxis:[{type:"value",min:Math.ceil(i-1),max:Math.ceil(r-1),axisLabel:{formatter:function(x){return x.toFixed(2)}}},{type:"value",gridIndex:1,min:l-s*.05,max:h+s*.05,axisLabel:{formatter:function(x){return x.toFixed(2)}}}],dataZoom:a?void 0:[{type:"inside",start:0,end:100,xAxisIndex:[0,1]},{start:0,end:100,xAxisIndex:[0,1]}],series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre},{name:"总潮位",type:"line",smooth:!0,data:e.hyubao},{name:"台风增水",type:"line",smooth:!0,data:e.hadd,yAxisIndex:1,xAxisIndex:1}]}}else{const i=Math.min(...e.hpre),r=Math.max(...e.hpre);n={title:{text:`${t.name}站点 ${t.time} 72 小时逐时潮位预报`,top:"1%",textStyle:{color:"hsl(220, 50%, 50%)",fontSize:15}},tooltip:{trigger:"axis"},legend:{data:["天文潮位"],right:"15%",top:"8%"},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},toolbox:{feature:{dataZoom:{yAxisIndex:"none"},saveAsImage:{}}},xAxis:{type:"category",boundaryGap:!1,data:e.time,axisLabel:{padding:[0,0,0,50]}},yAxis:{type:"value",min:Math.ceil(i-1),max:Math.floor(r+1),axisLabel:{formatter:function(l){return l.toFixed(2)}}},series:[{name:"天文潮位",type:"line",smooth:!0,data:e.hpre}]}}d||(n.graphic={type:"text",left:"center",top:"middle",silent:!0,invisible:e.hpre.length>0,style:{fill:"#9d9d9d",fontWeight:"bold",text:"该时间段暂无数据",fontFamily:"Microsoft YaHei",fontSize:"25px"}}),n&&o.setOption(n)},L=async o=>{const e=await y("forecast");o.addSource("stations",{type:"geojson",data:e,attribution:"name"});const t=await new Promise(d=>{o.loadImage("/png/custom_marker.png",(a,n)=>{d(n)})});o.addImage("station-marker",t),o.addLayer({id:"stations",source:"stations",type:"symbol",layout:{"icon-image":"station-marker","icon-size":.6,"text-field":["get","name"],"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,1.25],"text-anchor":"top","text-size":18},paint:{"text-color":"#e2e8f0"}})},m=o=>{const e=Math.floor(o),t=Math.floor((o-e)*60);return e+"° "+t+"'"},v=o=>{const e=c[o];return{name:e.name,pinyin:e.pinyin,time:new Date(Date.now()).toLocaleString().replace(/:\d\d$/,""),lon:m(e.coord[0]),lat:m(e.coord[1]),type:e.type}},z=async o=>{const e=`/api/v1/data/level/station/72?station=${c[o].pinyin}`,t=await fetch(e).then(s=>s.json()).then(s=>s.data);if(!t.hpre)return{time:[],hpre:[],isTyphoon:!1,hadd:[],hyubao:[]};const d=[],a=!!t.hadd,n=t.hpre,i=t.hyubao||[],r=t.hadd||[],l=t.hpre.length,h=new Date(t.time);for(let s=0;s<l;s++){const x=new Date(h.getTime()+s*60*60*1e3);d.push(x.toLocaleString().replace(/:\d\d$/,""))}return{time:d,isTyphoon:a,hyubao:i,hpre:n,hadd:r}};export{z as a,L as b,u as c,I as d,A as e,v as g,M as i};
