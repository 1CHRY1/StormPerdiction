import{u as j,a as I}from"./initMap-BiXK8HwB.js";import{b as P,c as F}from"./api-BAAjsRWi.js";import{g as z,r as _,c as N,h as B,o as H,b as g,d as x,e as t,t as m,u as w,f as u,i as S,l as k,q as O,s as A,_ as R}from"./index-l0_1r5o4.js";const C=o=>{const a=new Date(o),e=("0"+(a.getMonth()+1)).slice(-2),n=("0"+a.getDate()).slice(-2),c=("0"+a.getHours()).slice(-2);return e+"月"+n+"日 "+c+"时"},q=o=>o.filter(e=>e.isactive==="1").map(e=>({id:e.tfid,name:e.enname,enname:e.enname,startTime:e.starttime})),E=o=>o.map(e=>({id:e.id,name:e.name,time:C(e.time),powerAndStrong:`${e.power}`,speed:e.speed})),D=o=>{const a=Math.floor(o),e=Math.floor((o-a)*60);return a+"° "+e+"'"},T=o=>({type:"Feature",name:"",properties:{},geometry:{type:"Point",coordinates:o}}),V=o=>({type:"FeatureCollection",features:o.map((n,c)=>({type:"Feature",name:"",properties:{power:n.power,id:c},geometry:{type:"Point",coordinates:[n.lng,n.lat]}}))}),G=o=>({type:"Feature",name:"",properties:{},geometry:{type:"LineString",coordinates:o.map(e=>[e.lng,e.lat])}}),J=async(o,a)=>{const e=V(a),n=G(a);o.addSource(`storm-${a[0].name}-point`,{type:"geojson",data:e}),o.addSource(`storm-${a[0].name}-line`,{type:"geojson",data:n}),o.addLayer({id:`storm-${a[0].name}-line`,source:`storm-${a[0].name}-line`,type:"line",paint:{"line-color":"#60a5fa","line-width":1.5}}),o.addLayer({id:`storm-${a[0].name}-point`,source:`storm-${a[0].name}-point`,type:"circle",paint:{"circle-stroke-color":"#71717a","circle-stroke-width":1,"circle-radius":["case",["<=",["to-number",["get","power"]],8],4,["+",["*",["to-number",["get","power"]],.2],2.5]],"circle-color":["case",["<=",["to-number",["get","power"]],8],"#4ef04e",["<=",["to-number",["get","power"]],9],"#5281e6",["<=",["to-number",["get","power"]],11],"#e7e827",["<=",["to-number",["get","power"]],13],"#e49c26",["<=",["to-number",["get","power"]],15],"#e276de","#cd0000"]}})},K=async o=>{const a=await new Promise(e=>{o.loadImage("/png/typhoon.png",(n,c)=>{e(c)})});o.addImage("typhoon-icon",a),o.addSource("typhoon",{type:"geojson",data:T([0,0])})},Q=(o,a)=>{o.getSource("typhoon").setData(T(a)),o.getLayer("typhoon")||o.addLayer({id:"typhoon",source:"typhoon",type:"symbol",layout:{"icon-image":"typhoon-icon"}})},i=o=>(O("data-v-f58c37b1"),o=o(),A(),o),U={class:"relative flex h-full"},W={class:"flex h-full flex-auto relative justify-center"},X=i(()=>t("div",{class:"absolute z-10 top-3 py-1 px-16 text-yellow-400 font-bold text-2xl flex justify-center bg-slate-700/50 rounded"},m("实时台风路径"),-1)),Y={class:"bg-white w-[21rem] flex flex-col"},Z={class:"h-52 m-2 border border-zinc-300 bg-white flex flex-col"},ee=i(()=>t("div",{class:"h-10 leading-10 px-3 bg-[#1b6ec8] text-white"},"实时信息",-1)),te={key:0},oe={class:"mx-2 my-1 flex flex-col"},ae=i(()=>t("span",{class:"inline-block pr-2"},"台风名称:",-1)),se={class:"inline-block pr-3"},ne={class:"mx-2 my-1 flex flex-col"},le=i(()=>t("span",{class:"inline-block pr-2"},"当前时间:",-1)),ce={class:"inline-block pr-3"},re={class:"mx-2 my-1 flex flex-col"},ie=i(()=>t("span",{class:"inline-block pr-2"},"中心位置:",-1)),de={class:"inline-block pr-3"},pe={class:"inline-block pr-3"},ue={class:"mx-2 my-1 flex flex-col"},me=i(()=>t("span",{class:"inline-block pr-2"},"当前强度:",-1)),_e={class:"inline-block pr-3"},he={class:"mx-2 my-1 flex flex-col"},fe=i(()=>t("span",{class:"inline-block pr-2"},"当前风速:",-1)),ve={class:"inline-block pr-3"},be={key:1,class:"flex justify-center items-center flex-1 text-lg"},ye={class:"m-2 mt-3 w-80 bg-white"},ge=i(()=>t("div",{class:"h-10 leading-10 px-3 bg-[#1b6ec8] text-white"},"实时台风",-1)),xe={class:"border border-zinc-300"},we={class:"m-2 mt-3 w-80 bg-white flex flex-col flex-auto"},Se=i(()=>t("div",{class:"h-10 leading-10 px-3 bg-[#1b6ec8] text-white"},"历史路径",-1)),ke={class:"border border-zinc-300 flex-auto"},De=z({__name:"Typhoon",setup(o){const a=_(null),e=_(null),n=_(null),c=_("0"),s=_(null),b=j(),y=_(null),L=N(()=>e.value&&n.value?E(n.value[e.value].slice().reverse()):[]),M=r=>{r&&(e.value=r.name,c.value=(n.value[r.name].length-1).toString())},$=r=>{r&&(c.value=r.id)};return B(c,()=>{s.value=n.value[e.value][Number(c.value)],b.map&&(b.map.flyTo({center:[s.value.lng,s.value.lat]}),Q(b.map,[s.value.lng,s.value.lat]))}),H(async()=>{const r=await P();n.value=await F(r.filter(l=>l.isactive==="1").map(l=>l.tfid)),e.value=Object.keys(n.value)[0],c.value=(n.value[e.value].length-1).toString(),y.value=q(r);const h=await I(a.value,{center:[133.4,30.2],zoom:4}),d=[];Object.values(n.value).forEach(l=>{d.push(`storm-${l[0].name}-point`),J(h,l)}),K(h),h.on("click",l=>{const f=[[l.point.x-3,l.point.y-3],[l.point.x+3,l.point.y+3]],p=h.queryRenderedFeatures(f,{layers:d});if(p&&p[0]){const v=p[0].properties.id;c.value=v,e.value=p[0].source.split("-")[1]}})}),(r,h)=>{var f,p,v;const d=k("el-table-column"),l=k("el-table");return g(),x("div",U,[t("div",W,[X,t("div",{ref_key:"mapContainerRef",ref:a,class:"map-container h-full w-full"},null,512)]),t("div",Y,[t("div",Z,[ee,((f=y.value)==null?void 0:f.length)!==0?(g(),x("div",te,[t("div",oe,[t("div",null,[ae,t("span",se,m(s.value&&s.value.name),1)])]),t("div",ne,[t("div",null,[le,t("span",ce,m(s.value&&w(C)(s.value.time)),1)])]),t("div",re,[t("div",null,[ie,t("span",de,m(s.value&&w(D)(s.value.lng)),1),t("span",pe,m(s.value&&w(D)(s.value.lat)),1)])]),t("div",ue,[t("div",null,[me,t("span",_e,m(s.value&&`${(p=s.value)==null?void 0:p.power}级`),1)])]),t("div",he,[t("div",null,[fe,t("span",ve,m(s.value&&((v=s.value)==null?void 0:v.speed)+"m/s"),1)])])])):(g(),x("div",be," 当前无台风 "))]),t("div",ye,[ge,t("div",xe,[u(l,{stripe:"",border:"","table-layout":"auto",data:y.value,class:"h-[12rem]",onCurrentChange:M},{default:S(()=>[u(d,{prop:"name",label:"名称"}),u(d,{prop:"startTime",label:"开始时间"})]),_:1},8,["data"])])]),t("div",we,[Se,t("div",ke,[u(l,{stripe:"",border:"","table-layout":"auto",data:L.value,class:"h-[40vh]",onCurrentChange:$},{default:S(()=>[u(d,{prop:"time",label:"时间"}),u(d,{prop:"powerAndStrong",label:"强度"}),u(d,{prop:"speed",label:"风速"})]),_:1},8,["data"])])])])])}}}),Me=R(De,[["__scopeId","data-v-f58c37b1"]]);export{Me as default};
